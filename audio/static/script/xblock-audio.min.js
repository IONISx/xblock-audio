function AudioXBlockStudio(a,b){var c=new AudioXBlock.Server(a,b),d=new AudioXBlock.StudioView(c,a,b);d.render()}function AudioXBlockStudent(a,b){var c=new AudioXBlock.Server(a,b),d=new AudioXBlock.StudentView(c,a,b);d.render()}"undefined"!=typeof AudioXBlock&&AudioXBlock||(AudioXBlock={}),AudioXBlock.Server=function(){this.constructor.apply(this,arguments)},AudioXBlock.Server.prototype={constructor:function(a,b){this.runtime=a,this.element=b},url:function(a){return this.runtime.handlerUrl(this.element,a)},request:function(a,b){return $.ajax({type:"POST",url:this.url(a),data:JSON.stringify(b||{})})},get_state:function(){var a=$.Deferred();return this.request("get_state").done(function(b){b.success?a.resolve(b.state):a.reject([b.msg])}).fail(function(){a.reject(["Unable to retrieve the sound url"])}),a.promise()},play:function(){var a=$.Deferred();return this.request("play").done(function(b){b.success?a.resolve(b.url):a.reject([b.msg])}).fail(function(){a.reject(["Unable to retrieve the sound url"])}),a.promise()},edit:function(a){var b=$.Deferred();return this.request("edit",a).done(function(a){a.success?b.resolve(a):b.reject([a.msg])}).fail(function(){b.reject(["This problem could not be saved."])}),b.promise()}},AudioXBlock.StudioView=function(){this.constructor.apply(this,arguments)},AudioXBlock.StudioView.prototype={constructor:function(a,b,c){this.runtime=b,this.server=a,this.element=$(c)},save:function(){var a=this.element.find("#settings-tab"),b=a.data("metadata");this.element.find(".metadata_entry").each(function(){var a=$(this).find(".setting-input");b[a.data("field-name")].value=a.val()}),this.runtime.notify("save",{state:"start"});var c=this;this.server.edit({metadata:b}).done(function(){c.runtime.notify("save",{state:"end"}),a.data("metadata",b)}).fail(function(a){c.showError(a)})},cancel:function(){this.runtime.notify("cancel",{})},showError:function(a){this.runtime.notify("error",{msg:a})},setupEvents:function(){var a=this;this.element.on("click",".save-button",function(){a.save()}),this.element.on("click",".cancel-button",function(){a.cancel()})},render:function(){this.setupEvents()}},AudioXBlock.StudentView=function(){this.constructor.apply(this,arguments)},AudioXBlock.StudentView.prototype={constructor:function(a,b,c){this.runtime=b,this.server=a,this.element=$(c),this.state=null,this.template=Handlebars.compile(this.element.find("#xblock-audio-template").html())},_updateState:function(){var a=this,b=$.Deferred();return this.server.get_state().done(function(c){a.state=c,b.resolve(c)}).fail(function(a){b.reject(a)}),b.promise()},play:function(){this.server.play().done(function(a){new Howl({urls:[a],autoplay:!0})})},render:function(){var a=this;this._updateState().done(function(){a.element.find(".content").html(a.template(a.state)),a.state.options.autoplay&&a.play()})}};